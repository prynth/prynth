<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/__tests__/DryadPlayer.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="git://github.com/crucialfelix/dryadic">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/CommandMiddleware.js~CommandMiddleware.html">CommandMiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Dryad.js~Dryad.html">Dryad</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DryadPlayer.js~DryadPlayer.html">DryadPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DryadTree.js~DryadTree.html">DryadTree</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dryadic">dryadic</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hyperscript">hyperscript</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-run">run</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/__tests__/DryadPlayer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
jest.dontMock(&apos;../DryadPlayer&apos;);
jest.dontMock(&apos;../DryadTree&apos;);
jest.dontMock(&apos;../Dryad&apos;);
jest.dontMock(&apos;../hyperscript&apos;);
jest.dontMock(&apos;../CommandMiddleware&apos;);
jest.dontMock(&apos;../run&apos;);
jest.dontMock(&apos;../layer&apos;);

var Dryad = require(&apos;../Dryad&apos;).default;
var DryadPlayer = require(&apos;../DryadPlayer&apos;).default;
var layer = require(&apos;../layer&apos;).default;

class TypeOne extends Dryad {

  prepareForAdd() {
    return {
      something: () =&gt; {
        return Promise.resolve(&apos;something&apos;);
      }
    };
  }

  add() {
    return {
      run: () =&gt; {
        return Promise.resolve();
      }
    };
  }
}

class Child extends Dryad {}

class PrepareWithFunction extends Dryad {
  prepareForAdd() {
    return (/*context*/) =&gt; {
      return {
        one: 1,
        two: 2
      };
    };
  }
}

describe(&apos;DryadPlayer&apos;, function() {

  describe(&apos;basics&apos;, function() {
    var root;
    var player;

    beforeEach(() =&gt; {
      root = new TypeOne({}, [new Child()]);
      player = new DryadPlayer(root);
      player.addClass(TypeOne);
    });

    it(&apos;should construct&apos;, function() {
      expect(player).toBeTruthy();
    });

    it(&apos;should have registered TypeOne&apos;, function() {
      expect(player.classes[&apos;typeone&apos;]).toBeTruthy();
    });

    pit(&apos;should play&apos;, function() {
      return player.play();
    });

    pit(&apos;should update context on prepareForAdd&apos;, function() {
      // only if you give it a middleware to process &apos;something&apos;
      return player.play().then(() =&gt; {
        let rootId = player.tree.tree.id;
        let childId = player.tree.tree.children[0].id;
        expect(player.tree.contexts[rootId].something).toBe(&apos;something&apos;);
        expect(player.tree.contexts[childId].something).toBe(&apos;something&apos;);
      });
    });

    pit(&apos;should stop&apos;, function() {
      return player.stop();
    });

  });

  describe(&apos;prepareForAdd with function&apos;, function() {
    var root;
    var player;

    beforeEach(() =&gt; {
      root = new PrepareWithFunction();
      player = new DryadPlayer(root);
    });

    pit(&apos;should update context on prepareForAdd if that returns a function&apos;, function() {
      return player.play().then(() =&gt; {
        let rootId = player.tree.tree.id;
        expect(player.tree.contexts[rootId].one).toBe(1);
        expect(player.tree.contexts[rootId].two).toBe(2);
      });
    });
  });

  describe(&apos;callCommand&apos;, function() {

    let ran = false;

    class CallsRuntimeCommand extends Dryad {
      add(player) {
        return {
          run: (context) =&gt; {
            player.callCommand(context.id, {
              // context === innerContext
              run: (innerContext) =&gt; {
                // should execute this
                if (context.id !== innerContext.id) {
                  console.error(&apos;context&apos;, context, innerContext);
                  throw new Error(&apos;context and innerContext id do not match&apos;);
                }
                ran = true;
              }
            });
          }
        };
      }
    }

    pit(&apos;should execute a command object via context.callCommand&apos;, function() {
      let root = new CallsRuntimeCommand();
      let player = new DryadPlayer(root, [layer]);
      return player.play().then(() =&gt; {
        expect(ran).toBe(true);
      });
    });

    pit(&apos;should set context.callCommand in children&apos;, function() {
      let root = new Dryad({}, [new CallsRuntimeCommand()]);
      let player = new DryadPlayer(root, [layer]);
      return player.play().then(() =&gt; {
        expect(ran).toBe(true);
      });
    });

    // implement this test when you have implemented .update
    // pit(&apos;should execute context.callCommand for any Dryad added by .add&apos;, function() {
    //   let root = new CallsRuntimeCommand();
    //   let player = new DryadPlayer(root, [layer]);
    //   return player.play().then(() =&gt; {
    //     expect(ran).toBe(true);
    //   });
    //
    // });

  });

  // it(&apos;on prepare should update context of parent so child sees it&apos;, function() {
  //   return player.play().then(() =&gt; {
  //     let rootId = player.tree.tree.id;
  //     let childId = player.tree.tree.children[0].id;
  //
  //   });
  // });

});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
