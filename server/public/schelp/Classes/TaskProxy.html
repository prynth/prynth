<html><head><title>TaskProxy</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='./../prettify.js' type='text/javascript'></script>
<script src='./../lang-sc.js' type='text/javascript'></script>
<script type='text/javascript'>var helpRoot='./..';</script>
</head>
<ul id='menubar'></ul>
<body onload='fixTOC();prettyPrint()'>
<div class='contents'>
<div class='header'>
<div id='label'>SuperCollider CLASSES</div>
<div id='categories'><a href='./../Browse.html#Libraries>JITLib>Patterns'>Libraries>JITLib>Patterns</a>, <a href='./../Browse.html#Live Coding'>Live Coding</a></div>
<h1>TaskProxy</h1>
<div id='summary'>event stream reference</div>
</div>
<div class='subheader'>
<div id='filename'>Source: /usr/local/share/SuperCollider/SCClassLibrary/JITLib/Patterns/<a href='file:///usr/local/share/SuperCollider/SCClassLibrary/JITLib/Patterns/Pdef.sc'>Pdef.sc</a></div><div id='superclasses'>Inherits from: <a href="../Classes/PatternProxy.html">PatternProxy</a> : <a href="../Classes/Pattern.html">Pattern</a> : <a href="../Classes/AbstractFunction.html">AbstractFunction</a> : <a href="../Classes/Object.html">Object</a></div>
<div id='subclasses'>Subclasses: <a href="../Classes/EventPatternProxy.html">EventPatternProxy</a>, <a href="../Classes/Tdef.html">Tdef</a></div>
<div id='related'>See also: <a href="./../Classes/Tdef.html">Tdef</a></div>
</div>
<div id='toc'>
<ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*new'>new</a> </li>
<li class='toc3'><a href='#*default'>default</a> </li>
<li class='toc3'><a href='#*defaultQuant'>defaultQuant</a> </li>
<li class='toc2'><a href='#Inherited class methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-source'>source</a> </li>
<li class='toc3'><a href='#-clear'>clear</a> </li>
<li class='toc3'><a href='#-quant'>quant</a> </li>
<li class='toc3'><a href='#-condition'>condition</a> </li>
<li class='toc3'><a href='#-reset'>reset</a> </li>
<li class='toc3'><a href='#-envir'>envir</a> </li>
<li class='toc3'><a href='#-set'>set</a> </li>
<li class='toc3'><a href='#-endless'>endless</a> </li>
<li class='toc2'><a href='#a) using it as stream reference'>a) using it as stream reference</a></li>
<ul class='toc'><li class='toc3'><a href='#-source'>source</a> </li>
<li class='toc3'><a href='#-embedInStream'>embedInStream</a> </li>
</ul><li class='toc2'><a href='#b) using it as EventStreamPlayer'>b) using it as EventStreamPlayer</a></li>
<ul class='toc'><li class='toc3'><a href='#-play'>play</a> </li>
<li class='toc3'><a href='#-stop'>stop</a> </li>
<li class='toc3'><a href='#-player'>player</a> </li>
<li class='toc3'><a href='#-pause'>pause</a>  <a href='#-resume'>resume</a>  <a href='#-reset'>reset</a> </li>
<li class='toc3'><a href='#-isPlaying'>isPlaying</a> </li>
</ul><li class='toc2'><a href='#Inherited instance methods'>Inherited instance methods</a></li>
<li class='toc2'><a href='#Undocumented instance methods'>Undocumented instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-align'>align</a> </li>
<li class='toc3'><a href='#-asProtected'>asProtected</a> </li>
<li class='toc3'><a href='#-buildForProxy'>buildForProxy</a> </li>
<li class='toc3'><a href='#-canPause'>canPause</a> </li>
<li class='toc3'><a href='#-constrainStream'>constrainStream</a> </li>
<li class='toc3'><a href='#-convertFunction'>convertFunction</a> </li>
<li class='toc3'><a href='#-fork'>fork</a> </li>
<li class='toc3'><a href='#-hasEnded'>hasEnded</a> </li>
<li class='toc3'><a href='#-hasEnvir'>hasEnvir</a> </li>
<li class='toc3'><a href='#-hasPlayer'>hasPlayer</a> </li>
<li class='toc3'><a href='#-hasSource'>hasSource</a> </li>
<li class='toc3'><a href='#-isActive'>isActive</a> </li>
<li class='toc3'><a href='#-isEventPattern'>isEventPattern</a> </li>
<li class='toc3'><a href='#-isPaused'>isPaused</a> </li>
<li class='toc3'><a href='#-playOnce'>playOnce</a> </li>
<li class='toc3'><a href='#-playQuant'>playQuant</a> </li>
<li class='toc3'><a href='#-proxyControlClass'>proxyControlClass</a> </li>
<li class='toc3'><a href='#-wakeUp'>wakeUp</a> </li>
</ul></ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'><li class='toc2'><a href='#a) using TaskProxy as a player'>a) using TaskProxy as a player</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#b) embedding TaskProxy into other Tasks / Routines'>b) embedding TaskProxy into other Tasks / Routines</a></li>
<ul class='toc'></ul></ul></ul></div><h2><a class='anchor' name='description'>Description</a></h2>

<p>Keeps a reference to a task (time pattern) that can be replaced while playing. It plays on when the old stream ended and a new stream is set and schedules the changes to the beat.<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='cmethodname'><span class='methprefix'>*</span><a name='*new' href='./../Overviews/Methods.html#new'>new</a> (<span class='argstr'>source</span>)</h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>create a new instance with a function (the source). the source should be a <strong>routine function</strong> (see <a href="./../Classes/Tdef.html">Tdef</a>) or a <strong>pattern</strong> of time values.</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*default' href='./../Overviews/Methods.html#default'>default</a> </h3>
<div class='method'>
<p>a default source, if none is given. the default is a loop that does nothing with a 1.0 beat wait time.</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*defaultQuant' href='./../Overviews/Methods.html#defaultQuant'>defaultQuant</a></h3>
<h3 class='cmethodname'><span class='methprefix'>*</span><a name='*defaultQuant' href='./../Overviews/Methods.html#defaultQuant'>defaultQuant</a> = value</h3>
<div class='method'>
<p>set the default quantization value for the class. (default: 1.0). can be a pair [quant, offset]</div><h3><a class='anchor' name='Inherited class methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-source' href='./../Overviews/Methods.html#source'>source</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-source' href='./../Overviews/Methods.html#source'>source</a> = <span class='argstr'>obj</span></h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>set the source. If a quantization is given, schedule this change to the next beat the object is a <strong>routine function</strong>, which is evaluated in a protected way, so that failure will notify the proxy that it has stopped. The object can also be a <strong>pattern</strong> of time values.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-clear' href='./../Overviews/Methods.html#clear'>clear</a> </h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>set the source to nil</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-quant' href='./../Overviews/Methods.html#quant'>quant</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-quant' href='./../Overviews/Methods.html#quant'>quant</a> = <span class='argstr'>val</span></h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>get or set the quantization value. can be a pair [quant, offset]</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-condition' href='./../Overviews/Methods.html#condition'>condition</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-condition' href='./../Overviews/Methods.html#condition'>condition</a> = value</h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>provide a condition under which the pattern is switched when a new one is inserted. the stream value and a count is passed into the function. the methods <strong>count_(n)</strong> simply counts up to n and switches the pattern then</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-reset' href='./../Overviews/Methods.html#reset'>reset</a> </h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>switch the pattern immediately. (stuck conditions can be subverted by this)</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-envir' href='./../Overviews/Methods.html#envir'>envir</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-envir' href='./../Overviews/Methods.html#envir'>envir</a> = value</h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>provide a default environment for the proxy. If given, it is used as an environment for the routine function. When set for the first time, the routine pattern is rebuilt.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-set' href='./../Overviews/Methods.html#set'>set</a> ( <span class='argstr'>... args</span>)</h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>set arguments in the environment. If there is none, it is created and the routine pattern is rebuilt.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-endless' href='./../Overviews/Methods.html#endless'>endless</a> (<span class='argstr'>default</span>)</h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>returns a <a href="./../Classes/Prout.html">Prout</a> that plays the proxy endlessly, replacing <strong>nil</strong> with a <strong>default</strong> value (1 s. wait time). This allows to create streams that idle on until a new pattern is inserted.</div><h3><a class='anchor' name='a) using it as stream reference'>a) using it as stream reference</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-source' href='./../Overviews/Methods.html#source'>source</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-source' href='./../Overviews/Methods.html#source'>source</a> = <span class='argstr'>obj</span></h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>set the routine function / pattern (internally done by *new(key, obj)</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-embedInStream' href='./../Overviews/Methods.html#embedInStream'>embedInStream</a> (<span class='argstr'>inval</span>, <span class='argstr'>embed: true</span>, <span class='argstr'>default</span>)</h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>just like any stream, embeds itself in stream</div><h3><a class='anchor' name='b) using it as EventStreamPlayer'>b) using it as EventStreamPlayer</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-play' href='./../Overviews/Methods.html#play'>play</a> (<span class='argstr'>argClock</span>, <span class='argstr'>doReset: false</span>, <span class='argstr'>quant</span>)</h3>
<div class='method'>
<p>starts the TaskProxy and creates a player. if you want to play multiple instances, use <strong>.playOnce(clock, protoEvent, quant)</strong><h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>argClock<td class='argumentdesc'>
<p>which clock to use. if nil then the TempoClock.default is used.<tr><td class='argumentname'>doReset<td class='argumentdesc'>
<p>A <a href="./../Classes/Boolean.html">Boolean</a><tr><td class='argumentname'>quant<td class='argumentdesc'>
<p>can be an array of [quant, phase]</table></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-stop' href='./../Overviews/Methods.html#stop'>stop</a> </h3>
<div class='method'>
<p>stops the player</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-player' href='./../Overviews/Methods.html#player'>player</a> </h3>
<div class='method'>
<p>the current player (if the TaskProxy is simply used in other streams this is nil)</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-pause' href='./../Overviews/Methods.html#pause'>pause</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-resume' href='./../Overviews/Methods.html#resume'>resume</a> (<span class='argstr'>clock</span>, <span class='argstr'>quant</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-reset' href='./../Overviews/Methods.html#reset'>reset</a> </h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>perform player method</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-isPlaying' href='./../Overviews/Methods.html#isPlaying'>isPlaying</a> </h3>
<div class='method'>
<p>returns true if TaskProxy is running. if a TaskProxy is playing and its stream ends, it will schedule a stream for playing as soon as a new one is assigned to it.</div><h3><a class='anchor' name='Inherited instance methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h3><a class='anchor' name='Undocumented instance methods'>Undocumented instance methods</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-align' href='./../Overviews/Methods.html#align'>align</a> (<span class='argstr'>argQuant</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-asProtected' href='./../Overviews/Methods.html#asProtected'>asProtected</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-buildForProxy' href='./../Overviews/Methods.html#buildForProxy'>buildForProxy</a> (<span class='argstr'>proxy</span>, <span class='argstr'>channelOffset: 0</span>)</h3>
<div class='extmethod'>From extension in <a href='file:///usr/local/share/SuperCollider/SCClassLibrary/JITLib/ProxySpace/wrapForNodeProxy.sc'>/usr/local/share/SuperCollider/SCClassLibrary/JITLib/ProxySpace/wrapForNodeProxy.sc</a></div>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-canPause' href='./../Overviews/Methods.html#canPause'>canPause</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-constrainStream' href='./../Overviews/Methods.html#constrainStream'>constrainStream</a> (<span class='argstr'>stream</span>, <span class='argstr'>newStream</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-convertFunction' href='./../Overviews/Methods.html#convertFunction'>convertFunction</a> (<span class='argstr'>func</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-fork' href='./../Overviews/Methods.html#fork'>fork</a> (<span class='argstr'>clock</span>, <span class='argstr'>quant</span>, <span class='argstr'>event</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-hasEnded' href='./../Overviews/Methods.html#hasEnded'>hasEnded</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-hasEnvir' href='./../Overviews/Methods.html#hasEnvir'>hasEnvir</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-hasPlayer' href='./../Overviews/Methods.html#hasPlayer'>hasPlayer</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-hasSource' href='./../Overviews/Methods.html#hasSource'>hasSource</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-isActive' href='./../Overviews/Methods.html#isActive'>isActive</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-isEventPattern' href='./../Overviews/Methods.html#isEventPattern'>isEventPattern</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-isPaused' href='./../Overviews/Methods.html#isPaused'>isPaused</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-playOnce' href='./../Overviews/Methods.html#playOnce'>playOnce</a> (<span class='argstr'>argClock</span>, <span class='argstr'>doReset: false</span>, <span class='argstr'>quant</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-playQuant' href='./../Overviews/Methods.html#playQuant'>playQuant</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-playQuant' href='./../Overviews/Methods.html#playQuant'>playQuant</a> = value</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-proxyControlClass' href='./../Overviews/Methods.html#proxyControlClass'>proxyControlClass</a> </h3>
<div class='extmethod'>From extension in <a href='file:///usr/local/share/SuperCollider/SCClassLibrary/JITLib/ProxySpace/wrapForNodeProxy.sc'>/usr/local/share/SuperCollider/SCClassLibrary/JITLib/ProxySpace/wrapForNodeProxy.sc</a></div>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-wakeUp' href='./../Overviews/Methods.html#wakeUp'>wakeUp</a> </h3>
<h2><a class='anchor' name='examples'>Examples</a></h2>
<h3><a class='anchor' name='a) using TaskProxy as a player'>a) using TaskProxy as a player</a></h3>
<pre class='code prettyprint lang-sc'>// create an empty Tdef and play it.
x = TaskProxy.new;
x.play;


x.source = { loop { "ggggggggggggggggg9999ggg999ggg999gg".scramble.postln; 0.5.wait; } };


x.source = { loop { "---------////----------------------".scramble.postln; 0.25.wait; } };
x.source = { loop { thisThread.seconds.postln; 1.wait; } };
x.source = { loop { thisThread.seconds.postln; 1.01.wait; } };

TempoClock.default.tempo = 2;

x.source = { "the end".postln };
x.source = { "one more".postln };
x.source = { 10.do { "ten more".scramble.postln; 0.25.wait; } };
x.source = { loop { "many more".scramble.postln; 0.25.wait; } };

TempoClock.default.tempo = 1;

x.stop;
x.play;
x.stop;</pre>
<pre class='code prettyprint lang-sc'>// sound example

(
// load a synthdef
s.boot;
SynthDef("pdef_grainlet",
    { arg out=0, freq=440, sustain=0.05;
        var env;
        env = EnvGen.kr(Env.perc(0.01, sustain, 0.3), doneAction:2);
        Out.ar(out, SinOsc.ar(freq, 0, env))
    }).add;
)
x.play;

(
x.source = {
    loop {
        s.sendMsg("/s_new", "pdef_grainlet", -1,0,0, \freq, rrand(600, 640));
        0.1.wait;
    }
}
)

(
x.source = {
    var x;
    x = Pseries(300, 20, 100).loop.asStream;
    loop {
        s.sendMsg("/s_new", "pdef_grainlet", -1,0,0, \freq, x.next);
        0.05.wait;
    }
}
)

(
x.source = {
    var x;
    x = Plazy { Pseries(300 + 300.rand, 10 + 30.rand, 10 + 30.rand) }.loop.asStream;
    loop {
        s.sendMsg("/s_new", "pdef_grainlet", -1,0,0, \freq, x.next);
        0.05.wait;
    }
}
)

// metronome
(
y = TaskProxy {
    loop { s.sendMsg("/s_new", "pdef_grainlet", -1,0,0, \freq, 1500); 1.wait; }
};
y.play;
)

// play ending stream once
(
x.source = {
    var x, dt;
    dt = [0.1, 0.125, 0.05].choose;
    x = Plazy { Pseries(1300 + 300.rand, 110 + 130.rand, 16) }.asStream;
    x.do { arg item;
        s.sendMsg("/s_new", "pdef_grainlet", -1,0,0, \freq, item);
        dt.wait;
    }
}
)

... and so on ...

x.stop;
y.stop;</pre>
<h3><a class='anchor' name='b) embedding TaskProxy into other Tasks / Routines'>b) embedding TaskProxy into other Tasks / Routines</a></h3>
<pre class='code prettyprint lang-sc'>(
#a, c = { TaskProxy.new } ! 2;
a.source = { "one".postln; 1.wait; "two".postln };
c.source = { var z; z = Synth(\default); 0.5.wait; z.release };
r = Task {
    "counting...".postln;
    2.wait;
    a.embedInStream;
    1.wait;
    c.embedInStream;
    "done.".postln;
};
)

r.play; // play a stream

c.source = { var z; z = Synth(\default, [\freq, 300]); 1.5.wait; z.release }; // change the def

r.reset;
r.play;

// of course TaskProxies can be used in other Tdefs:
(
b = TaskProxy.new;
b.source = {
    "counting...".postln;
    2.wait;
    a.embedInStream;
    1.wait;
    c.embedInStream;
    "done.".postln;
};
)
b.playOnce;

// if one wants to branch off a stream in a separate thread, asStream is used.
(
Routine {
    c.asStream.play;
    0.1.wait;
    c.asStream.play;
    0.1.wait;
    a.asStream.play;

}.play;
)</pre>

<p><div class='doclink'>source: <a href='file:///usr/local/share/SuperCollider/HelpSource/Classes/TaskProxy.schelp'>/usr/local/share/SuperCollider/HelpSource/Classes/TaskProxy.schelp</a><br>link::Classes/TaskProxy::<br>sc version: 3.8dev</div></div></body></html>