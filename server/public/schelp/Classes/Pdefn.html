<html><head><title>Pdefn</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='./../prettify.js' type='text/javascript'></script>
<script src='./../lang-sc.js' type='text/javascript'></script>
<script type='text/javascript'>var helpRoot='./..';</script>
</head>
<ul id='menubar'></ul>
<body onload='fixTOC();prettyPrint()'>
<div class='contents'>
<div class='header'>
<div id='label'>SuperCollider CLASSES</div>
<div id='categories'><a href='./../Browse.html#Libraries>JITLib>Patterns'>Libraries>JITLib>Patterns</a>, <a href='./../Browse.html#Live Coding'>Live Coding</a></div>
<h1>Pdefn</h1>
<div id='summary'>non event stream reference definition</div>
</div>
<div class='subheader'>
<div id='filename'>Source: /usr/local/share/SuperCollider/SCClassLibrary/JITLib/Patterns/<a href='file:///usr/local/share/SuperCollider/SCClassLibrary/JITLib/Patterns/Pdef.sc'>Pdef.sc</a></div><div id='superclasses'>Inherits from: <a href="../Classes/PatternProxy.html">PatternProxy</a> : <a href="../Classes/Pattern.html">Pattern</a> : <a href="../Classes/AbstractFunction.html">AbstractFunction</a> : <a href="../Classes/Object.html">Object</a></div>
<div id='related'>See also: <a href="./../Classes/Pdef.html">Pdef</a></div>
</div>
<div id='toc'>
<ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'><li class='toc2'><a href='#First Example'>First Example</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Creation'>Creation</a></li>
<ul class='toc'><li class='toc3'><a href='#*new'>new</a> </li>
<li class='toc3'><a href='#*default'>default</a> </li>
<li class='toc3'><a href='#*removeAll'>removeAll</a> </li>
<li class='toc3'><a href='#*clear'>clear</a> </li>
<li class='toc3'><a href='#*all'>all</a> </li>
</ul><li class='toc2'><a href='#Inherited class methods'>Inherited class methods</a></li>
<li class='toc2'><a href='#Undocumented class methods'>Undocumented class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*hasGlobalDictionary'>hasGlobalDictionary</a> </li>
</ul></ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Inherited instance methods'>Inherited instance methods</a></li>
<li class='toc2'><a href='#Undocumented instance methods'>Undocumented instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-copy'>copy</a> </li>
<li class='toc3'><a href='#-key'>key</a> </li>
<li class='toc3'><a href='#-map'>map</a> </li>
</ul></ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'><li class='toc2'><a href='#Pdefn in expressions'>Pdefn in expressions</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Embedding Pdefn in other patterns'>Embedding Pdefn in other patterns</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Timing'>Timing</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#update condition'>update condition</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Reset'>Reset</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Functions as arguments to Pdefn'>Functions as arguments to Pdefn</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#The (inner) environment'>The (inner) environment</a></li>
<ul class='toc'></ul></ul></ul></div><h2><a class='anchor' name='description'>Description</a></h2>

<p>Pdefn provides an interface to its superclass <a href="./../Classes/PatternProxy.html">PatternProxy</a>, keeping a reference to a stream that can be replaced while playing. One pattern may be used in many streams in different places. A change in the pattern definition propagates through all streams.
<p>Pdef and Pdefn use separate global collections.<pre class='code prettyprint lang-sc'>Pdefn(key)    //returns the instance
Pdefn(key, pat)    //defines the pattern and returns the instance, like Pdef, Tdef and Ndef.</pre>

<p>It is very similar to <a href="./../Classes/PatternProxy.html">PatternProxy</a>.
<p>Pdefn can be used to store value patterns globally (for <strong>event patterns</strong>, see <a href="./../Classes/Pdef.html">Pdef</a>). Overview: <a href="./../Overviews/JITLib.html">JITLib</a><h3><a class='anchor' name='First Example'>First Example</a></h3>
<pre class='code prettyprint lang-sc'>s.boot;

Pdefn(\x, Pbrown(0, 6, 0.1, inf));
Pbind(\note, Pdefn(\x), \dur, 0.3).play;
Pbind(\note, Pdefn(\x), \dur, 0.1, \ctranspose, 15).play;
// now change the definition
Pdefn(\x, Pseq([0, 3, 5, 7, 9, 11], inf));
Pdefn(\x, Pseq([0, 3, 3, 7], inf) + Pseq([0, [0, 3], [0, 5, 7]], inf));</pre>
<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3><a class='anchor' name='Creation'>Creation</a></h3>
<h3 class='cmethodname'><span class='methprefix'>*</span><a name='*new' href='./../Overviews/Methods.html#new'>new</a> (<span class='argstr'>key</span>, <span class='argstr'>item</span>)</h3>
<div class='method'>
<p>Store the pattern in a global dictionary under key, replacing its pattern with the new one. If the pattern is a <strong>function</strong>, Pdefn creates a <a href="./../Classes/Prout.html">Prout</a> with this function, passing in the envir, if given(see below).
<p>Using <strong>*new(key)</strong> you can access the pattern at that key (if none is given, a default silent event is created)<pre class='code prettyprint lang-sc'>// pattern as an argument
Pdefn(\x, Pseq([1, 2, 5, 6, 7], inf));
Pdefn(\x); // omitting the second argument, we can access the proxy
Pdefn(\x).asStream.nextN(20); // ... play one event stream
Pdefn(\x).source.postcs; // ... and inspect the event pattern itself.


// function as an argument, create a new pattern each time it is called
Pdefn(\x, { Pseq({ 10.rand } ! 8) });
Pn(Pdefn(\x)).asStream.nextN(16);

// the function is called in the incoming event as current environment, so parameters can be passed:
Pdef(\stut, { Pstutter(~stutter ? 1, ~pattern) }); // we use here a Pdef (not a Pdefn!)
Pdefn(\y, Pdef(\stut) &lt;&gt; (pattern: Pdefn(\x), stutter: Pseq([2, 2, 4, 3], inf))).asStream.nextN(16);</pre>
</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*default' href='./../Overviews/Methods.html#default'>default</a> </h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>Default source, if none is given. The default is a Pattern that returns 1.0 (This is 1 and not 0 to avoid deadlocks when used as a duration pattern. In a sense, 1 is just as generic as 0).</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*removeAll' href='./../Overviews/Methods.html#removeAll'>removeAll</a> </h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>Remove all proxies from the global dictionary ( <a href="#*all">*all</a>)</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*clear' href='./../Overviews/Methods.html#clear'>clear</a> </h3>
<div class='supmethod'>From superclass: <a href='./../Classes/PatternProxy.html'>PatternProxy</a></div>
<div class='method'>
<p>Clear all proxies, setting their source to silence.</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*all' href='./../Overviews/Methods.html#all'>all</a></h3>
<h3 class='cmethodname'><span class='methprefix'>*</span><a name='*all' href='./../Overviews/Methods.html#all'>all</a> = value</h3>
<div class='method'>
<p>Set or return the environment ( <a href="./../Classes/IdentityDictionary.html">IdentityDictionary</a> ) that stores all Pdefns.</div><h3><a class='anchor' name='Inherited class methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h3><a class='anchor' name='Undocumented class methods'>Undocumented class methods</a></h3>
<h3 class='cmethodname'><span class='methprefix'>*</span><a name='*hasGlobalDictionary' href='./../Overviews/Methods.html#hasGlobalDictionary'>hasGlobalDictionary</a> </h3>
<h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3><a class='anchor' name='Inherited instance methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h3><a class='anchor' name='Undocumented instance methods'>Undocumented instance methods</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-copy' href='./../Overviews/Methods.html#copy'>copy</a> (<span class='argstr'>toKey</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-key' href='./../Overviews/Methods.html#key'>key</a> </h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-map' href='./../Overviews/Methods.html#map'>map</a> ( <span class='argstr'>... args</span>)</h3>
<h2><a class='anchor' name='examples'>Examples</a></h2>
<h3><a class='anchor' name='Pdefn in expressions'>Pdefn in expressions</a></h3>
<pre class='code prettyprint lang-sc'>Pdefn(\c, Pdefn(\a) + Pdefn(\b));

t = Pdefn(\c).asStream; // create a stream from Pdefn(\c)

t.value; // default value for a Pdefn is 1, so that it is a good time value default.

Pdefn(\a, 100); // (re)define Pdefn(\a) as 100

t.value;

Pdefn(\b, Pseq([1, 2, 3], inf)); // (re)define Pdefn(\b) as Pseq([1, 2, 3], inf)

3.do { t.value.postln };

Pdefn(\c, Pdefn(\a) * Pdefn(\b) - Pdefn(\a)); // (re)define Pdefn(\c)

8.do { t.value.postln };

Pdefn(\a, Prand([1, 4, 2], inf)); // (re)define Pdefn(\a)</pre>
<h3><a class='anchor' name='Embedding Pdefn in other patterns'>Embedding Pdefn in other patterns</a></h3>
<pre class='code prettyprint lang-sc'>Pdefn(\x, Pseq([1, 2, 3], inf));

x = Pseq([0, 0, Pdefn(\x)], inf).asStream;

t = Task({ loop({ x.next.postln; 0.3.wait }) }).play;


Pdefn(\x, Pseq([55, 66, 77],inf));
Pdefn(\x, Pseq([55, 66, 77],1));

t.stop;



// Pdefn can be accessed in multiple streams

(
SynthDef("Pdefhelp", { arg out, freq, sustain=1, amp=1, pan;
    var env, u=1;
    env = EnvGen.kr(Env.perc(0.03, sustain), 1, doneAction:2);
    5.do { var d; d = exprand(0.01, 1); u = SinOsc.ar(d * 300, u, rrand(0.1,1.2) * d, 1) };
    Out.ar(out, Pan2.ar(SinOsc.ar(u + 1 * freq, 0, amp * env), pan));

}).add;
s.boot;
)

(
Pdefn(\deg, Pseq([0, 3, 2],inf));

Pset(\instrument, \Pdefhelp,
    Ppar([
        Pbind(\degree, Pdefn(\deg), \pan, -0.8),
        Pbind(\degree, Pdefn(\deg), \dur, 1/3, \pan, 0.8)
])
).play;
)

Pdefn(\deg, Prand([0, 3, [1s, 4]],inf));

Pdefn(\deg, Pn(Pshuf([0, 3, 2, 7, 6],2),inf));

(
Pdefn(\deg, Plazy { var pat;
    pat = [Pshuf([0, 3, 2, 7, 6],2), Pseries(0, 1, 11), Pseries(11, -1, 11)].choose;
    Pn(pat, inf)
});
)</pre>
<h3><a class='anchor' name='Timing'>Timing</a></h3>

<p>When does the definition change?
<p>If quant is set, the update is done at the next beat or whatever is specified:<pre class='code prettyprint lang-sc'>Pdefn(\deg).quant = 4;
Pdefn(\deg, Pn(Pseries(0, 1, 8),inf));

Pdefn(\deg).quant = nil; // activate immediately again

(
Pdefn(\deg, {
    loop {
    5.do { |i|
        #[1, 3, 4].choose.yield;
        #[5, 0, 12].choose.yield;
        #[14, 3, 4].choose.do { |j| (i % j).postln.yield };
    }
    }
})
)</pre>
<h3><a class='anchor' name='update condition'>update condition</a></h3>

<p>In order to be able to switch to a new pattern under a certain condition, the instance variable <strong>condition</strong> can be set to a function that returns a boolean. Value and a count index are passed to the function. The condition is always valid for the <strong>next pattern</strong> inserted. For stuck conditions, the <strong>reset</strong> message can be used.
<p>As counting up (such as <em>"every nth event, a swap can happen"</em>) is a common task, there is a method for this, called <strong>count(n)</strong>.<pre class='code prettyprint lang-sc'>z = Pbind(\degree, Pdefn(\x, \), \dur, 0.25).play;
Pdefn(\x, Pseq((0..5), inf)).condition_({ |val, i| i.postln % 6 == 0 });
Pdefn(\x, Pseq((7..0), inf)).condition_({ |val, i| i.postln % 8 == 0 });


// the above is equvalent to:
Pdefn(\x, Pseq((7..0), inf)).count(8);</pre>
<h3><a class='anchor' name='Reset'>Reset</a></h3>
<pre class='code prettyprint lang-sc'>// reset to change immediately:
Pdefn(\x).reset;

Pdefn(\x).stop;</pre>
<h3><a class='anchor' name='Functions as arguments to Pdefn'>Functions as arguments to Pdefn</a></h3>
<pre class='code prettyprint lang-sc'>Pdefn(\deg, { loop { yield(0.1.rand.round(0.01) + [2, 3, 9].choose) } });

// equivalent to:

Pdefn(\deg, Prout { loop { yield(0.1.rand.round(0.01) + [2, 3, 9].choose) } });

// this is not exactly true, see below..</pre>
<h3><a class='anchor' name='The (inner) environment'>The (inner) environment</a></h3>
<pre class='code prettyprint lang-sc'>// set() creates a local environment that overrides the outer currentEnvironment

Pdefn(\z).set(\a, 1, \b, 5);
(
Pdefn(\z, { |e|
    loop { yield((e.a + e.b) + 0.1.rand.round(0.01)) }
})
); // [1]

t = Pdefn(\z).asStream;

t.nextN(3);

(
Pdefn(\z, { |e|
    //(e.a + e.b) + 0.1.rand.round(0.01) 1
    Pseq([1, 2, e.a], 1)
})
);

Pdefn(\z, Pseq([1, 2, 3], 1));

e = Pdefn(\z).envir


Pdefn(\z).set(\a, 3);

t.next;

Pdefn(\z).set(\a, Pseq([1, 2, 3], inf));

t.reset;
t.nextN(3);

Pdefn(\z).envir; // post the envir



// if you want to keep using the currentEnvironment at the same time,
// assign the currentEnvironment to the envir's parent (or proto) field
// (this shouldn't be a proxy space of course.)

Pdefn(\z).envir.parent = currentEnvironment;
~a = 9;
~b = 10;

t.nextN(3);</pre>

<p><div class='doclink'>source: <a href='file:///usr/local/share/SuperCollider/HelpSource/Classes/Pdefn.schelp'>/usr/local/share/SuperCollider/HelpSource/Classes/Pdefn.schelp</a><br>link::Classes/Pdefn::<br>sc version: 3.8dev</div></div></body></html>